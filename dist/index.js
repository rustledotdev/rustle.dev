"use strict";var t=Object.defineProperty,e=(e,n,r)=>((e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r)(e,"symbol"!=typeof n?n+"":n,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("./useRustle-B1x3IY79.js"),r=require("react/jsx-runtime"),s=require("react"),i=require("./fingerprinting-DpjyWojc.js"),o=require("./localeUtils-CDVu_9vT.js"),a=require("./cookies-Dw9bISRk.js"),c=require("./index-CbC6Ie1r.js"),l="undefined"==typeof window;function u(){const t=n.useRustleContext(),[e,r]=s.useState(!1),[o,a]=s.useState(null),[c]=s.useState(new Map),{config:u,currentLocale:h,setLocale:f,localeData:d}=t,p=s.useMemo(()=>d[h]||{},[h,d]),w=s.useMemo(()=>!l||!0===u.enableSSRDynamicTranslation,[u]),g=s.useCallback(async(t,e,r)=>{if(u.deactivate)return t;const s=e||h,i=!1!==(null==r?void 0:r.cache);if(s===u.sourceLanguage)return t;const o=p[t];if(o)return u.debug,o;const a=d[s];if(a){if(a[t])return u.debug,a[t];for(const[e,n]of Object.entries(a))if("string"==typeof n&&(n===t||e===t))return u.debug,n}if(l&&!w)return u.debug,t;const f=`${t}_${u.sourceLanguage}_${s}`;if(c.has(f))return c.get(f);if(i){const e=n.defaultStorageManager.getCachedTranslation(t,u.sourceLanguage,s);if(e)return e}const g=y(t,s,r);c.set(f,g);try{return await g}finally{c.delete(f)}},[u,h,d,c]),y=async(t,e,s)=>{r(!0),a(null);const o=(null==s?void 0:s.retryCount)||0;if(!1!==(null==s?void 0:s.cache)){const s=n.defaultStorageManager.getCachedTranslation(t,u.sourceLanguage,e);if(s)return u.debug,r(!1),s}const c=p[t];if(c)return u.debug,!1!==(null==s?void 0:s.cache)&&n.defaultStorageManager.cacheTranslation(t,u.sourceLanguage,e,c),r(!1),c;try{if(!u.apiKey)throw new Error("API key is required. Please provide apiKey in RustleBox configuration.");const o=n.createAPIClient({apiKey:u.apiKey}),a=await o.translateSingle(t,u.sourceLanguage,e,u.model,null==s?void 0:s.context),c=i.cleanTranslationWithContext(a,{originalText:t,targetLanguage:e,sourceLanguage:u.sourceLanguage,isHTML:!1});return!1!==(null==s?void 0:s.cache)&&n.defaultStorageManager.cacheTranslation(t,u.sourceLanguage,e,c),u.debug,r(!1),c}catch(l){const n=l instanceof Error?l.message:"Translation failed";if(u.debug,o<3){const n=1e3*Math.pow(2,o);return u.debug,await new Promise(t=>setTimeout(t,n)),y(t,e,{...s,retryCount:o+1})}const i=p[t];if(i)return u.debug,r(!1),i;if(a(n),r(!1),u.fallback)return u.debug,t;throw new Error(n)}},m=s.useCallback(async(t,e,s)=>{if(u.deactivate)return t.reduce((t,{id:e,text:n})=>({...t,[e]:n}),{});const o=e||h,c=!1!==(null==s?void 0:s.cache),l=(null==s?void 0:s.retryCount)||0;if(o===u.sourceLanguage)return t.reduce((t,{id:e,text:n})=>({...t,[e]:n}),{});r(!0),a(null);try{if(!u.apiKey)throw new Error("API key is required. Please provide apiKey in RustleBox configuration.");const e=n.createAPIClient({apiKey:u.apiKey}),a=await e.translateBatch({entries:t.map(t=>({id:t.id,text:t.text,context:t.context?{tags:t.context.tags||[],file:t.context.file||""}:void 0})),sourceLanguage:u.sourceLanguage,targetLanguage:o,model:u.model},null==s?void 0:s.requestKey);if(!a.success)throw new Error(a.error||"Batch translation failed");const l=i.cleanBatchTranslations(a.translations);return c&&Object.entries(l).forEach(([e,r])=>{var s;const i=null==(s=t.find(t=>t.id===e))?void 0:s.text;i&&n.defaultStorageManager.cacheTranslation(i,u.sourceLanguage,o,r)}),u.debug,r(!1),l}catch(f){const n=f instanceof Error?f.message:"Batch translation failed";if(u.debug,l<3){const n=1e3*Math.pow(2,l);return u.debug,await new Promise(t=>setTimeout(t,n)),m(t,e,{...s,retryCount:l+1})}const i={};let o=!1;if(t.forEach(({id:t,text:e})=>{const n=p[e];n?(i[t]=n,o=!0,u.debug):u.fallback&&(i[t]=e)}),o||u.fallback)return r(!1),u.debug,i;throw a(n),r(!1),new Error(n)}},[u,h,p]),v=s.useCallback(()=>{n.defaultStorageManager.clearCache(),u.debug},[u.debug]);return{currentLocale:h,setLocale:f,translate:g,translateBatch:m,clearCache:v,isLoading:e||t.isLoading,error:o||t.error}}function h(t){let e=0;if(0===t.length)return e.toString();for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return Math.abs(e).toString(36)}function f(t,e){return`fp_${h(`${t}:${e}`)}`}function d(t){return`ch_${h(t.trim().toLowerCase())}`}function p(t){return t.trim().replace(/\s+/g," ").replace(/\n/g," ").trim()}function w(t){const e=p(t);return!!e&&(!/^[\d\s\p{P}\p{S}]+$/u.test(e)&&(!(e.length<2)&&!/^[A-Z_][A-Z0-9_]*$/.test(e)))}function g(){return`tr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function y(t={}){const{supportedLocales:e=["en","es","fr","de","it","pt"],defaultLocale:n="en",enablePathRouting:r=!1,excludePaths:i=["/api","/static","/_next","/favicon.ico"],includeDefaultLocaleInPath:a=!1,onLocaleChange:c}=t,[l,u]=s.useState(n),[h,f]=s.useState("/");s.useEffect(()=>{r&&o.AdvancedPathLocaleManager.configure({enabled:!0,supportedLocales:e,defaultLocale:n,excludePaths:i,includeDefaultLocaleInPath:a,redirectToDefaultLocale:!1})},[r,e,n,i,a]),s.useEffect(()=>{if("undefined"==typeof window)return;const{locale:t,pathWithoutLocale:n}=o.PathLocaleManager.extractLocaleFromPath(window.location.pathname,e),s=t||o.UniversalLocaleManager.getCurrentLocale();u(s),f(n),o.UniversalLocaleManager.configurePathBasedRouting(r,e),o.UniversalLocaleManager.setCurrentLocale(s,!1)},[r,e]),s.useEffect(()=>{if("undefined"==typeof window||!r)return;const t=()=>{const{locale:t,pathWithoutLocale:r}=o.PathLocaleManager.extractLocaleFromPath(window.location.pathname,e),s=t||n;u(s),f(r),o.UniversalLocaleManager.setCurrentLocale(s,!1),c&&c(s)};return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)},[r,e,n,c]);const d=s.useCallback((t,n=!0)=>{if(u(t),o.UniversalLocaleManager.setCurrentLocale(t,r&&n),r&&n&&"undefined"!=typeof window){const n=w(h,t),r=n+window.location.search+window.location.hash;window.history.pushState(null,"",r),f(o.PathLocaleManager.removeLocaleFromPath(n,e))}c&&c(t)},[r,h,e,c]),p=s.useCallback((t,e)=>{const n=e||l;if(r){const e=w(t,n);window.location.href=e}else d(n,!1),window.location.href=t},[l,r,d]),w=s.useCallback((t,s)=>{const i=s||l;return r?i!==n||a?o.PathLocaleManager.addLocaleToPath(t,i):o.PathLocaleManager.removeLocaleFromPath(t,e):t},[l,r,n,a,e]),g=s.useCallback(t=>o.PathLocaleManager.removeLocaleFromPath(t,e),[e]),y=s.useCallback((t="")=>{var s;return r?o.AdvancedPathLocaleManager.generateAlternateLinks((null==(s=null==window?void 0:window.location)?void 0:s.pathname)||h,t):e.map(e=>({locale:e,href:`${t}${h}?locale=${e}`,hreflang:e===n?"x-default":e}))},[r,e,h,n]);return{currentLocale:l,setLocale:d,navigateToLocalizedPath:p,getLocalizedPath:w,removeLocaleFromPath:g,generateAlternateLinks:y,isPathBasedRoutingEnabled:r,supportedLocales:e,pathWithoutLocale:h}}class m{constructor(){e(this,"plugins",new Map),e(this,"config",null)}use(t){if(this.plugins.has(t.name),this.plugins.set(t.name,t),this.config&&t.onInit)try{const e=t.onInit(this.config);e instanceof Promise&&e.catch(t=>{})}catch(e){}return this}unuse(t){const e=this.plugins.get(t);if(!e)return!1;if(e.onDestroy)try{const t=e.onDestroy();t instanceof Promise&&t.catch(t=>{})}catch(n){}return this.plugins.delete(t)}getPlugin(t){return this.plugins.get(t)}getPlugins(){return Array.from(this.plugins.values())}async init(t){this.config=t;const e=Array.from(this.plugins.values()).map(async e=>{if(e.onInit)try{await e.onInit(t)}catch(n){}});await Promise.all(e)}async destroy(){const t=Array.from(this.plugins.values()).map(async t=>{if(t.onDestroy)try{await t.onDestroy()}catch(e){}});await Promise.all(t),this.plugins.clear(),this.config=null}async executeHook(t,...e){const n=[];for(const i of this.plugins.values()){const o=i[t];if("function"==typeof o)try{const t=await o.apply(i,e);n.push(t)}catch(r){if(i.onError)try{await i.onError(r instanceof Error?r:new Error(String(r)),{hook:t,args:e})}catch(s){}}}return n}async executeHookFirst(t,...e){for(const s of this.plugins.values()){const i=s[t];if("function"==typeof i)try{const t=await i.apply(s,e);if(void 0!==t)return t}catch(n){if(s.onError)try{await s.onError(n instanceof Error?n:new Error(String(n)),{hook:t,args:e})}catch(r){}}}}async executeHookChain(t,e,...n){let r=e;for(const o of this.plugins.values()){const e=o[t];if("function"==typeof e)try{const t=await e.apply(o,[r,...n.slice(1)]);void 0!==t&&(r=t)}catch(s){if(o.onError)try{await o.onError(s instanceof Error?s:new Error(String(s)),{hook:t,args:[r,...n.slice(1)]})}catch(i){}}}return r}}const v={name:"debug",version:"1.0.0",onInit(t){t.debug},beforeTranslate:(t,e)=>t,afterTranslate:(t,e,n)=>e,onLocaleChange(t,e){},onError(t,e){},onCacheHit(t,e){},onCacheMiss(t){}},x={name:"performance",version:"1.0.0",private:{startTimes:new Map,stats:{translations:0,cacheHits:0,cacheMisses:0,errors:0,totalTime:0}},onInit(){},beforeTranslate(t){return this.private.startTimes.set(t,performance.now()),t},afterTranslate(t,e){const n=this.private.startTimes.get(t);if(n){const e=performance.now()-n;this.private.stats.totalTime+=e,this.private.stats.translations++,this.private.startTimes.delete(t)}return e},onCacheHit(){this.private.stats.cacheHits++},onCacheMiss(){this.private.stats.cacheMisses++},onError(){this.private.stats.errors++},onDestroy(){this.private.stats}};class b{constructor(){e(this,"isOnline",!0),e(this,"onlineCallbacks",[]),e(this,"offlineCallbacks",[]),e(this,"pendingTranslations",new Map),"undefined"!=typeof window&&(this.isOnline=navigator.onLine,this.setupEventListeners())}setupEventListeners(){window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this))}handleOnline(){this.isOnline=!0,this.onlineCallbacks.forEach(t=>{try{t()}catch(e){}}),this.syncPendingTranslations()}handleOffline(){this.isOnline=!1,this.offlineCallbacks.forEach(t=>{try{t()}catch(e){}})}getOnlineStatus(){return this.isOnline}onOnline(t){return this.onlineCallbacks.push(t),()=>{const e=this.onlineCallbacks.indexOf(t);e>-1&&this.onlineCallbacks.splice(e,1)}}onOffline(t){return this.offlineCallbacks.push(t),()=>{const e=this.offlineCallbacks.indexOf(t);e>-1&&this.offlineCallbacks.splice(e,1)}}async getTranslation(t,e,r,s=!0){const i=n.defaultStorageManager.getCachedTranslation(t,e,r);if(i)return i;if(!this.isOnline){const n=`${t}_${e}_${r}`;return this.pendingTranslations.set(n,{text:t,locale:r,timestamp:Date.now()}),s?t:null}return null}cacheTranslation(t,e,r,s){n.defaultStorageManager.setCachedTranslation(t,e,r,s)}async preloadTranslations(t){for(const[e,r]of Object.entries(t))for(const[t,s]of Object.entries(r))n.defaultStorageManager.setCachedTranslation(t,"en",e,s)}getPendingTranslationsCount(){return this.pendingTranslations.size}getPendingTranslations(){return Array.from(this.pendingTranslations.entries()).map(([t,e])=>({key:t,...e}))}async syncPendingTranslations(){0!==this.pendingTranslations.size&&this.pendingTranslations.clear()}clearPendingTranslations(){this.pendingTranslations.clear()}getCacheStats(){return{totalCached:0,cacheSize:"0 KB",oldestEntry:null,newestEntry:null}}clearCache(){if("undefined"!=typeof localStorage){Object.keys(localStorage).forEach(t=>{t.startsWith("rustle_translation_")&&localStorage.removeItem(t)})}}exportCache(){const t={};if("undefined"!=typeof localStorage){Object.keys(localStorage).forEach(e=>{e.startsWith("rustle_translation_")&&(t[e]=localStorage.getItem(e)||"")})}return JSON.stringify(t,null,2)}importCache(t){try{const e=JSON.parse(t);"undefined"!=typeof localStorage&&Object.entries(e).forEach(([t,e])=>{t.startsWith("rustle_translation_")&&"string"==typeof e&&localStorage.setItem(t,e)})}catch(e){throw new Error("Invalid cache data format")}}cleanupOldCache(t=6048e5){if("undefined"==typeof localStorage)return;const e=Date.now(),n=Object.keys(localStorage);n.forEach(n=>{if(n.startsWith("rustle_translation_"))try{const r=localStorage.getItem(n);if(r){const s=JSON.parse(r);s.timestamp&&e-s.timestamp>t&&localStorage.removeItem(n)}}catch(r){localStorage.removeItem(n)}})}destroy(){"undefined"!=typeof window&&(window.removeEventListener("online",this.handleOnline.bind(this)),window.removeEventListener("offline",this.handleOffline.bind(this))),this.onlineCallbacks=[],this.offlineCallbacks=[],this.pendingTranslations.clear()}}const L=new b;const T=new class{constructor(){e(this,"config",null),e(this,"observer",null),e(this,"processedNodes",new Set),e(this,"apiClient",null)}initialize(t){this.config=c.RustleConfigSchema.parse({sourceLanguage:"en",targetLanguages:[],apiKey:"",...t,currentLocale:t.currentLocale||a.getLocaleFromCookie()||t.sourceLanguage||"en"}),this.config.deactivate?this.config.debug:(this.apiClient=n.createAPIClient({apiKey:this.config.apiKey}),this.config.debug,"undefined"!=typeof window&&this.startProcessing())}startProcessing(){this.config&&!this.config.deactivate&&(this.processExistingElements(),this.setupMutationObserver(),this.setupLocaleHandling())}processExistingElements(){var t;if(!(null==(t=this.config)?void 0:t.auto))return;document.querySelectorAll("body *").forEach(t=>this.processElement(t))}processElement(t){var e,n,r,s;if(!this.config)return;if(this.processedNodes.has(t))return;const i=t.tagName.toLowerCase();if(null==(n=null==(e=this.config.autoConfig)?void 0:e.exclude)?void 0:n.includes(i))return;if((null==(r=this.config.autoConfig)?void 0:r.include)&&!this.config.autoConfig.include.includes(i))return;if("false"===t.getAttribute("data-i18n"))return;if("true"===t.getAttribute("data-i18n-pause"))return;const o=null==(s=t.textContent)?void 0:s.trim();if(!o||!w(o))return;const a=function(t){const e=[];let n=t;for(;n&&n!==document.body;)e.unshift(n.tagName.toLowerCase()),n=n.parentElement;return e.slice(0,5)}(t),c=f(window.location.pathname,0),l=d(o);t.setAttribute("data-i18n","true"),t.setAttribute("data-i18n-fingerprint",c),t.setAttribute("data-i18n-content-hash",l),t.setAttribute("data-i18n-tags",a.join(",")),t.setAttribute("data-i18n-source",o),this.processedNodes.add(t),this.config.debug}setupMutationObserver(){var t;(null==(t=this.config)?void 0:t.auto)&&(this.observer=new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;this.processElement(e);e.querySelectorAll("*").forEach(t=>this.processElement(t))}})})}),this.observer.observe(document.body,{childList:!0,subtree:!0}))}setupLocaleHandling(){window.addEventListener("rustleLocaleChange",t=>{const e=t.detail.locale;this.setLocale(e)})}setLocale(t){this.config&&(this.config.targetLanguages.includes(t)||t===this.config.sourceLanguage)&&(this.config={...this.config,currentLocale:t},a.setLocaleToCookie(t),this.config.debug,this.translateElements(),window.dispatchEvent(new CustomEvent("rustleLocaleChanged",{detail:{locale:t}})))}async translateElements(){if(!this.config)return;const t=document.querySelectorAll('[data-i18n="true"]');for(const e of t)await this.translateElement(e)}async translateElement(t){if(!this.config)return;const e=t.getAttribute("data-i18n-source"),r=t.getAttribute("data-i18n-fingerprint");if(e&&r)if(this.config.currentLocale!==this.config.sourceLanguage)try{if(!this.config.currentLocale)return;const r=n.defaultStorageManager.getCachedTranslation(e,this.config.sourceLanguage,this.config.currentLocale);if(r)return void(t.textContent=r);if(this.apiClient&&this.config.currentLocale){const r=await this.apiClient.translateSingle(e,this.config.sourceLanguage,this.config.currentLocale,this.config.model);t.textContent=r,this.config.currentLocale&&n.defaultStorageManager.cacheTranslation(e,this.config.sourceLanguage,this.config.currentLocale,r),this.config.debug}}catch(s){this.config.debug,this.config.fallback&&(t.textContent=e)}else t.textContent=e}getCurrentLocale(){var t;return(null==(t=this.config)?void 0:t.currentLocale)||null}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.processedNodes.clear(),this.config=null,this.apiClient=null}};function M(t){T.initialize(t)}"undefined"!=typeof window&&(window.rustleEngine=M,window.rustleSetLocale=t=>T.setLocale(t),window.rustleGetLocale=()=>T.getCurrentLocale());class ${constructor(t){e(this,"observer",null),e(this,"callbacks",new Map),"undefined"!=typeof IntersectionObserver&&(this.observer=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=this.callbacks.get(t.target);e&&(e(),this.unobserve(t.target))}})},{rootMargin:"50px",threshold:.1,...t}))}observe(t,e){this.observer?(this.callbacks.set(t,e),this.observer.observe(t)):e()}unobserve(t){this.observer&&this.observer.unobserve(t),this.callbacks.delete(t)}disconnect(){this.observer&&this.observer.disconnect(),this.callbacks.clear()}}function P(t,e){return"requestIdleCallback"in window?window.requestIdleCallback(t,e):setTimeout(t,(null==e?void 0:e.timeout)||1)}class E{constructor(){e(this,"operations",[]),e(this,"scheduled",!1)}add(t){this.operations.push(t),this.schedule()}schedule(){this.scheduled||(this.scheduled=!0,P(()=>{this.flush()}))}flush(){const t=this.operations.splice(0);t.length>1?(document.createDocumentFragment(),t.forEach(t=>t())):1===t.length&&t[0]&&t[0](),this.scheduled=!1}clear(){this.operations=[],this.scheduled=!1}}class C{constructor(){e(this,"maxMemoryUsage",0),e(this,"checkInterval",null)}start(t=5e3){this.checkInterval||(this.checkInterval=setInterval(()=>{this.checkMemory()},t))}stop(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}checkMemory(){if("memory"in performance){const t=performance.memory.usedJSHeapSize;t>this.maxMemoryUsage&&(this.maxMemoryUsage=t)}}getStats(){if("memory"in performance){const t=performance.memory;return{current:t.usedJSHeapSize,max:this.maxMemoryUsage,limit:t.jsHeapSizeLimit}}return null}}class _{constructor(){e(this,"metrics",new Map)}mark(t){"performance"in window&&performance.mark&&performance.mark(t)}measure(t,e,n){var r;if("performance"in window&&performance.measure)try{performance.measure(t,e,n);const s=performance.getEntriesByName(t,"measure"),i=(null==(r=s[s.length-1])?void 0:r.duration)||0;return this.addMetric(t,i),i}catch(s){}return 0}addMetric(t,e){this.metrics.has(t)||this.metrics.set(t,[]);const n=this.metrics.get(t);n.push(e),n.length>100&&n.shift()}getMetrics(t){const e=this.metrics.get(t);return e&&0!==e.length?{avg:e.reduce((t,e)=>t+e,0)/e.length,min:Math.min(...e),max:Math.max(...e),count:e.length}:null}getAllMetrics(){const t={};for(const[e]of this.metrics){const n=this.getMetrics(e);n&&(t[e]=n)}return t}clear(){this.metrics.clear(),"performance"in window&&performance.clearMarks&&(performance.clearMarks(),performance.clearMeasures())}}const O={lazyObserver:new $,domBatcher:new E,memoryMonitor:new C,performanceCollector:new _,init(t){(null==t?void 0:t.enableMemoryMonitoring)&&this.memoryMonitor.start(t.memoryCheckInterval)},cleanup(){this.lazyObserver.disconnect(),this.domBatcher.clear(),this.memoryMonitor.stop(),this.performanceCollector.clear()}};function S(t,e,n){return("function"==typeof t?t():t)?e().catch(t=>n):Promise.resolve(n)}class k{constructor(){e(this,"cache",new Map),e(this,"loading",new Map)}async get(t,e){if(this.cache.has(t))return this.cache.get(t);if(this.loading.has(t))return this.loading.get(t);const n=e().then(e=>(this.cache.set(t,e),this.loading.delete(t),e)).catch(e=>{throw this.loading.delete(t),e});return this.loading.set(t,n),n}has(t){return this.cache.has(t)}clear(){this.cache.clear(),this.loading.clear()}size(){return this.cache.size}}const I=new k;function B(t){switch(t){case"intersectionObserver":return"undefined"!=typeof IntersectionObserver;case"mutationObserver":return"undefined"!=typeof MutationObserver;case"localStorage":try{return"undefined"!=typeof localStorage&&null!==localStorage}catch{return!1}case"webWorkers":return"undefined"!=typeof Worker;case"serviceWorker":return"serviceWorker"in navigator;case"indexedDB":return"indexedDB"in window;default:return!1}}const j={selectiveImport:(t,e)=>{const n={};return e.forEach(e=>{e in t&&(n[e]=t[e])}),n},deferImport:(t,e=100)=>new Promise((n,r)=>{setTimeout(()=>{t().then(n).catch(r)},e)}),chunkLoad:async(t,e=3)=>{const n=[];for(let r=0;r<t.length;r+=e){const s=t.slice(r,r+e),i=await Promise.all(s.map(t=>t()));n.push(...i),r+e<t.length&&await new Promise(t=>setTimeout(t,10))}return n}},q=class t{constructor(){e(this,"config",{}),this.loadConfiguration()}static getInstance(){return t.instance||(t.instance=new t),t.instance}loadConfiguration(){if("undefined"!=typeof process&&process.env&&(this.config={...this.config,apiUrl:process.env.RUSTLE_API_URL||process.env.NEXT_PUBLIC_RUSTLE_API_URL,apiKey:process.env.RUSTLE_API_KEY,sourceLanguage:process.env.RUSTLE_SOURCE_LANGUAGE||"en",localeBasePath:process.env.RUSTLE_LOCALE_PATH||"/rustle/locales",debug:"true"===process.env.RUSTLE_DEBUG,useVirtualDOM:"false"!==process.env.RUSTLE_USE_VIRTUAL_DOM,enableBatching:"false"!==process.env.RUSTLE_ENABLE_BATCHING,enableCaching:"false"!==process.env.RUSTLE_ENABLE_CACHING,enableOffline:"true"===process.env.RUSTLE_ENABLE_OFFLINE,batchTimeout:parseInt(process.env.RUSTLE_BATCH_TIMEOUT||"50"),maxRetries:parseInt(process.env.RUSTLE_MAX_RETRIES||"3"),cacheTimeout:parseInt(process.env.RUSTLE_CACHE_TIMEOUT||"86400000")}),"undefined"!=typeof window){const t=window.__RUSTLE_CONFIG__;t&&(this.config={...this.config,...t})}this.config={apiUrl:"https://api.rustle.dev/api",sourceLanguage:"en",targetLanguages:["es","fr","de","it","pt"],defaultModel:"gpt-3.5-turbo",localeBasePath:"/rustle/locales",useVirtualDOM:!0,enableBatching:!0,enableCaching:!0,enableOffline:!1,batchTimeout:50,maxRetries:3,cacheTimeout:864e5,obfuscateRequests:!1,enableCSP:!0,debug:!1,enableMetrics:!1,...this.config}}get(t){return this.config[t]}set(t,e){this.config[t]=e}update(t){this.config={...this.config,...t}}getAll(){return{...this.config}}reset(){this.config={},this.loadConfiguration()}validate(){const t=[];if(this.config.apiKey||t.push("API key is required"),this.config.apiUrl)try{new URL(this.config.apiUrl)}catch{t.push("Invalid API URL format")}else t.push("API URL is required");return this.config.sourceLanguage||t.push("Source language is required"),this.config.targetLanguages&&0!==this.config.targetLanguages.length||t.push("At least one target language is required"),this.config.localeBasePath||t.push("Locale base path is required"),this.config.batchTimeout&&this.config.batchTimeout<0&&t.push("Batch timeout must be non-negative"),this.config.maxRetries&&this.config.maxRetries<0&&t.push("Max retries must be non-negative"),this.config.cacheTimeout&&this.config.cacheTimeout<0&&t.push("Cache timeout must be non-negative"),{valid:0===t.length,errors:t}}};e(q,"instance");let D=q;const A=D.getInstance(),N={isDevelopment:()=>!0===A.get("debug")||"undefined"!=typeof process&&"development"===process.env.NODE_ENV,isProduction(){return!this.isDevelopment()},getBestModel:()=>A.get("defaultModel")||"gpt-3.5-turbo",isFeatureEnabled:t=>!0===A.get(t),getLocalePath:t=>`${A.get("localeBasePath")||"/rustle/locales"}/${t}.json`,getMasterPath:()=>`${A.get("localeBasePath")||"/rustle/locales"}/master.json`,setupEnvironment(t){switch(t){case"development":A.update({debug:!0,enableMetrics:!0,obfuscateRequests:!1});break;case"staging":A.update({debug:!1,enableMetrics:!0,obfuscateRequests:!0});break;case"production":A.update({debug:!1,enableMetrics:!1,obfuscateRequests:!0})}}};exports.AutoTranslate=n.AutoTranslate,exports.RustleAPIError=n.RustleAPIError,exports.RustleBox=n.RustleBox,exports.StorageManager=n.StorageManager,exports.createAPIClient=n.createAPIClient,exports.defaultStorageManager=n.defaultStorageManager,exports.useRustle=n.useRustle,exports.AdvancedPathLocaleManager=o.AdvancedPathLocaleManager,exports.MetadataPathManager=o.MetadataPathManager,exports.PathLocaleManager=o.PathLocaleManager,exports.ServerLocaleManager=o.ServerLocaleManager,exports.UniversalLocaleManager=o.UniversalLocaleManager,exports.commonPatterns=o.commonPatterns,exports.createLocaleManager=o.createLocaleManager,exports.extractTemplate=o.extractTemplate,exports.interpolateText=o.interpolateText,exports.getLocaleFromCookie=a.getLocaleFromCookie,exports.removeLocaleFromCookie=a.removeLocaleFromCookie,exports.setLocaleToCookie=a.setLocaleToCookie,exports.ConfigManager=D,exports.DOMBatcher=E,exports.LazyObserver=$,exports.MemoryMonitor=C,exports.ModuleCache=k,exports.OfflineManager=b,exports.PerformanceCollector=_,exports.PluginManager=m,exports.RustleEngine=class{constructor(t){e(this,"config"),e(this,"localeData",{}),e(this,"observer",null),e(this,"processedElements",new Set),e(this,"pendingTranslations",new Map),e(this,"pluginManager",new m),this.config={deactivate:!1,sourceLanguage:"en",targetLanguages:["es","fr","de","it","pt"],currentLocale:"en",apiKey:"",model:"gpt-3.5-turbo",debug:!1,auto:!0,fallback:!0,...t},this.config.debug}use(t){return this.pluginManager.use(t),this}unuse(t){return this.pluginManager.unuse(t)}getPlugin(t){return this.pluginManager.getPlugin(t)}isOffline(){return!L.getOnlineStatus()}getPendingTranslationsCount(){return L.getPendingTranslationsCount()}exportCache(){return L.exportCache()}importCache(t){L.importCache(t)}clearCache(){L.clearCache(),n.defaultStorageManager.clearCache(),this.config.debug}async init(){this.config.deactivate?this.config.debug:(await this.pluginManager.init(this.config),await this.loadLocaleData(this.config.currentLocale),this.localeData&&Object.keys(this.localeData).length>0&&await L.preloadTranslations(this.localeData),this.config.auto&&"undefined"!=typeof document&&this.startAutoProcessing())}async loadLocaleData(t){if(!this.localeData[t]){try{const e=await fetch(`/rustle/locales/${t}.json`);if(e.ok){const n=await e.json();return this.localeData[t]=n,void this.config.debug}}catch(e){this.config.debug}this.localeData[t]={}}}startAutoProcessing(){this.processExistingElements(),this.observer=new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&this.processElement(t)})})}),this.observer.observe(document.body,{childList:!0,subtree:!0}),this.config.debug}processExistingElements(){if("undefined"==typeof document)return;document.querySelectorAll("body *").forEach(t=>this.processElement(t))}processElement(t){var e,n,r,s;if(this.processedElements.has(t))return;if("false"===t.getAttribute("data-i18n"))return;if("true"===t.getAttribute("data-i18n-pause"))return;const i=t.tagName.toLowerCase();if(null==(n=null==(e=this.config.autoConfig)?void 0:e.exclude)?void 0:n.includes(i))return;if((null==(r=this.config.autoConfig)?void 0:r.include)&&!this.config.autoConfig.include.includes(i))return;const o=null==(s=t.textContent)?void 0:s.trim();if(!o||!w(o))return;const a=p(o);if(!a)return;const c=f(window.location.pathname,0),l=d(a);t.setAttribute("data-i18n","true"),t.setAttribute("data-i18n-fingerprint",c),t.setAttribute("data-i18n-content-hash",l),t.setAttribute("data-i18n-source",a),this.processedElements.add(t),this.config.currentLocale!==this.config.sourceLanguage&&this.translateElement(t,a),this.config.debug}async translateElement(t,e){try{const n=await this.translate(e,this.config.currentLocale);t.textContent=n}catch(n){this.config.debug,this.config.fallback&&(t.textContent=e)}}async translate(t,e,n){var r;const s=e||this.config.currentLocale,i=!1!==(null==n?void 0:n.cache);if(s===this.config.sourceLanguage)return t;const o=await this.pluginManager.executeHookChain("beforeTranslate",t,s,n),a=null==(r=this.localeData[s])?void 0:r[o];if(a)return await this.pluginManager.executeHook("onCacheHit",`static_${o}_${s}`,a),a;const c=`${o}_${this.config.sourceLanguage}_${s}`;if(this.pendingTranslations.has(c))return this.pendingTranslations.get(c);if(i){const t=await L.getTranslation(o,this.config.sourceLanguage,s,!0);if(t&&t!==o)return await this.pluginManager.executeHook("onCacheHit",c,t),t;if(!L.getOnlineStatus())return o;await this.pluginManager.executeHook("onCacheMiss",c)}const l=this.performTranslation(o,s,i);this.pendingTranslations.set(c,l);try{const t=await l;return await this.pluginManager.executeHookChain("afterTranslate",t,o,s,n)}catch(u){throw await this.pluginManager.executeHook("onError",u instanceof Error?u:new Error(String(u)),{text:o,target:s,options:n}),u}finally{this.pendingTranslations.delete(c)}}async performTranslation(t,e,r){try{const s=n.createAPIClient({apiKey:this.config.apiKey}),i=await s.translateSingle(t,this.config.sourceLanguage,e,this.config.model);return r&&n.defaultStorageManager.cacheTranslation(t,this.config.sourceLanguage,e,i),this.config.debug,i}catch(s){if(this.config.debug,this.config.fallback)return t;throw s}}async setLocale(t){if(t===this.config.currentLocale)return;const e=this.config.currentLocale;if(this.config.currentLocale=t,await this.pluginManager.executeHook("onLocaleChange",t,e),await this.loadLocaleData(t),"undefined"!=typeof document){const t=document.querySelectorAll('[data-i18n="true"]');for(const e of t){const t=e.getAttribute("data-i18n-source");t&&await this.translateElement(e,t)}}this.config.debug}getCurrentLocale(){return this.config.currentLocale}async destroy(){await this.pluginManager.destroy(),L.destroy(),this.observer&&(this.observer.disconnect(),this.observer=null),this.processedElements.clear(),this.pendingTranslations.clear(),this.config.debug}},exports.RustleGo=function({children:t,fallback:e,className:i,cache:o=!0}){const a=n.useRustleContext(),{translate:c,translateBatch:l,isLoading:h}=u(),[f,d]=s.useState(t),[y,m]=s.useState(null),v=s.useRef(null),x=s.useRef(new Map),b=s.useRef([]),L=s.useRef(null),T=s.useRef(null),{config:M,currentLocale:$,localeData:P}=a,E=s.useRef($),C=s.useRef(!1),_=P[$]||{};s.useEffect(()=>{const t=t=>{var e;const n=null==(e=t.detail)?void 0:e.locale;n&&n!==E.current&&(C.current=!0,E.current=n)};return window.addEventListener("rustleLocaleChanged",t),()=>{window.removeEventListener("rustleLocaleChanged",t)}},[]),s.useEffect(()=>{if(M.deactivate)return void d(t);if($===M.sourceLanguage)return void d(t);const n=$!==E.current,r=C.current;E.current=$,r&&(C.current=!1);(async()=>{try{if(m(null),M.debug,T.current&&(M.debug,T.current=null),L.current&&(clearTimeout(L.current),L.current=null),b.current.length>0){const t=[...b.current];b.current=[],t.forEach(t=>{t.reject(new Error("Translation cancelled due to locale change"))}),M.debug}(n||r)&&x.current.clear();const e=await O(t);d(e)}catch(s){const n=s instanceof Error?s.message:"Translation failed";m(n),M.debug,M.fallback&&d(e||t)}})()},[t,$,M,e]),s.useEffect(()=>()=>{L.current&&clearTimeout(L.current),b.current=[],T.current=null},[]),s.useEffect(()=>()=>{L.current&&clearTimeout(L.current)},[]);const O=async t=>{var e,n,r,i,u;if("string"==typeof t)try{return await(async t=>{const e=p(t);if(!w(e))return t;const n=`${e}_${$}`;if(o&&x.current.has(n))return M.debug,x.current.get(n);const r=_[e];return r?(M.debug,o&&x.current.set(n,r),r):new Promise((n,r)=>{b.current.push({text:e,resolve:n,reject:e=>{e.message.includes("cancelled")&&M.fallback?n(t):r(e)}}),L.current&&clearTimeout(L.current),L.current=setTimeout(async()=>{const t=[...b.current];if(b.current=[],0===t.length)return;const e=`rustlego_batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;T.current=e;try{const n=t.map((t,e)=>({id:`batch_${e}`,text:t.text,context:{tags:[],file:"dynamic"}}));if(!l)throw new Error("translateBatch function is not available");const r=await l(n,$,{cache:o,requestKey:e});if(T.current!==e)return M.debug,void t.forEach(t=>{t.reject(new Error("Translation request was cancelled"))});T.current=null,t.forEach((t,e)=>{const n=r[`batch_${e}`]||t.text;if(o){const e=`${t.text}_${$}`;x.current.set(e,n)}t.resolve(n)}),M.debug}catch(n){if(T.current!==e)return M.debug,void t.forEach(t=>{t.reject(new Error("Translation request was cancelled"))});M.debug,t.forEach(async(t,e)=>{try{const e=await c(t.text,$,{cache:o});if(o){const n=`${t.text}_${$}`;x.current.set(n,e)}t.resolve(e)}catch(n){a.config.fallback?t.resolve(t.text):t.reject(n)}})}},100)})})(t)}catch(h){return M.debug,t}if("number"==typeof t||"boolean"==typeof t||null==t)return t;if(Array.isArray(t)){return await Promise.all(t.map(t=>O(t)))}if(s.isValidElement(t)){const o=t;if("string"==typeof o.type){const s=o.type.toLowerCase();if(null==(n=null==(e=M.autoConfig)?void 0:e.exclude)?void 0:n.includes(s))return t;if((null==(r=M.autoConfig)?void 0:r.include)&&!M.autoConfig.include.includes(s))return t}if("false"===(null==(i=o.props)?void 0:i["data-i18n"]))return t;if("true"===(null==(u=o.props)?void 0:u["data-i18n-pause"]))return t;let a=o.props.children;a&&(a=await O(a));try{return s.cloneElement(o,{...o.props,"data-i18n":"true","data-i18n-dynamic":"true","data-i18n-id":g()},a)}catch(f){return M.debug,t}}return t};return h&&!f?r.jsx("div",{ref:v,className:i,"data-rustle-go":"loading",children:e||t}):y&&!M.fallback?r.jsx("div",{ref:v,className:i,"data-rustle-go":"error","data-rustle-error":y,children:e||t}):r.jsx("div",{ref:v,className:i,"data-rustle-go":"translated","data-rustle-locale":$,children:f})},exports.TranslatedHTML=function({html:t,tag:e="div",className:o,style:a,cache:c=!0,fallback:l,...h}){const f=n.useRustleContext(),{translateBatch:d}=u(),[y,m]=s.useState(t),[v,x]=s.useState(!1),[b,L]=s.useState(null),T=s.useRef(new Map),{config:M,currentLocale:$}=f;s.useEffect(()=>{if(M.deactivate)return void m(t);if($===M.sourceLanguage)return void m(t);(async()=>{try{x(!0),L(null);const e=P(t);if(0===e.length)return void m(t);const n=[],r={};e.forEach((t,e)=>{const s=`${t}_${$}`;c&&T.current.has(s)?r[`node_${e}`]=T.current.get(s):n.push({id:`node_${e}`,text:t,context:{tags:["html"],file:"dynamic"}})});let s={};if(n.length>0){if(!d)throw new Error("translateBatch function is not available");const t=await d(n,$,{cache:c});s={};for(const[e,r]of Object.entries(t)){const t=n.find(t=>t.id===e),o=i.cleanTranslationWithContext(r,{originalText:null==t?void 0:t.text,targetLanguage:$,sourceLanguage:M.sourceLanguage,isHTML:!1});s[e]=o}c&&n.forEach((t,e)=>{const n=s[t.id];if(n){const e=`${t.text}_${$}`;T.current.set(e,n)}})}const o={...r,...s};let a=t;e.forEach((t,e)=>{const n=o[`node_${e}`];n&&n!==t&&(a=E(a,t,n))});const l=i.sanitizeHTML(a);m(l)}catch(e){const n=e instanceof Error?e.message:"HTML translation failed";L(n),M.debug,M.fallback&&m(l||t)}finally{x(!1)}})()},[t,$,M,c,l]);const P=t=>{const e=document.createElement("div");e.innerHTML=t;const n=[],r=t=>{var e;if(t.nodeType===Node.TEXT_NODE){const r=null==(e=t.textContent)?void 0:e.trim();r&&w(p(r))&&n.push(r)}else if(t.nodeType===Node.ELEMENT_NODE){if("false"===t.getAttribute("data-i18n"))return;Array.from(t.childNodes).forEach(r)}};return Array.from(e.childNodes).forEach(r),n},E=(t,e,n)=>{const r=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(?<=>)([^<]*?)${r}([^<]*?)(?=<|$)`,"g");return t.replace(s,(t,e,r)=>`${e}${n}${r}`)};return v?r.jsx(e,{className:o,style:a,"data-translated-html":"loading",...h,dangerouslySetInnerHTML:{t:l||t}}):b&&!M.fallback?r.jsx(e,{className:o,style:a,"data-translated-html":"error","data-translation-error":b,...h,dangerouslySetInnerHTML:{t:l||t}}):r.jsx(e,{className:o,style:a,"data-translated-html":"translated","data-translation-locale":$,"data-translation-id":g(),...h,dangerouslySetInnerHTML:{t:y}})},exports.applyRustle=u,exports.browserOnlyImport=function(t,e){return S("undefined"!=typeof window,t,e)},exports.bundleOptimization=j,exports.cancelIdleCallback=function(t){"cancelIdleCallback"in window?window.cancelIdleCallback(t):clearTimeout(t)},exports.conditionalImport=S,exports.configHelpers=N,exports.debounce=function(t,e,n={}){const{leading:r=!1,trailing:s=!0,maxWait:i}=n;let o=null,a=null,c=null,l=0;return(...n)=>{const u=Date.now(),h=null===c;if(c=u,o&&clearTimeout(o),a&&clearTimeout(a),r&&h)return l=u,void t(...n);s&&(o=setTimeout(()=>{l=Date.now(),t(...n),c=null},e)),i&&!a&&(a=setTimeout(()=>{c&&u-l>=i&&(l=Date.now(),t(...n),c=null)},i))}},exports.debugPlugin=v,exports.featureSupported=B,exports.globalConfig=A,exports.lazyComponent=function(t,e){if(void 0===s)throw new Error("lazyComponent can only be used in React environment");return s.lazy(async()=>{try{const e=await t();return"default"in e?{default:e.default}:{default:e}}catch(n){if(e)return{default:e};throw n}})},exports.lazyImport=function(t,e){let n=null,r=null;return async()=>n||(r||(r=t().then(t=>(n=t,r=null,t)).catch(t=>{if(r=null,e)return n=e,e;throw t}),r))},exports.loadPolyfillIfNeeded=async function(t,e){if(!B(t))try{await e()}catch(n){}},exports.memoize=function(t,e=100){const n=new Map;return(...r)=>{const s=JSON.stringify(r);if(n.has(s))return n.get(s);const i=t(...r);if(n.size>=e){const t=n.keys().next().value;void 0!==t&&n.delete(t)}return n.set(s,i),i}},exports.moduleCache=I,exports.nodeOnlyImport=function(t,e){return S("undefined"==typeof window&&"undefined"!=typeof process,t,e)},exports.offlineManager=L,exports.performancePlugin=x,exports.performanceUtils=O,exports.preloadModule=function(t,e=0){e>0?setTimeout(()=>{t().catch(()=>{})},e):t().catch(()=>{})},exports.requestIdleCallback=P,exports.rustleEngine=M,exports.throttle=function(t,e,n={}){const{leading:r=!0,trailing:s=!0}=n;let i=!1,o=null;return(...n)=>{o=n,i||(r&&t(...n),i=!0,setTimeout(()=>{i=!1,s&&o&&(t(...o),o=null)},e))}},exports.usePathBasedLocale=y,exports.withPathBasedLocale=function(t,e){const n=n=>{const r=y(e);return s.createElement(t,{...n,...r})};return n.displayName=`withPathBasedLocale(${t.displayName||t.name})`,n};
