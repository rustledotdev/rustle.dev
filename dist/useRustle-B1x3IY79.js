"use strict";var t=Object.defineProperty,e=(e,n,s)=>((e,n,s)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s)(e,"symbol"!=typeof n?n+"":n,s);const n=require("react/jsx-runtime"),s=require("react"),i=require("./fingerprinting-DpjyWojc.js"),r=require("./cookies-Dw9bISRk.js"),o="rustle_",a="1.0";class c{constructor(){e(this,"storage",new Map)}getItem(t){return this.storage.get(t)||null}setItem(t,e){this.storage.set(t,e)}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}class l{constructor(t){e(this,"adapter"),this.adapter=t||this.getDefaultAdapter()}getDefaultAdapter(){try{if("undefined"!=typeof window&&window.localStorage)return localStorage.setItem("__test__","test"),localStorage.removeItem("__test__"),localStorage}catch(t){}return new c}getKey(t,e){return`${o}${t}_${e}`}cacheLocaleData(t,e){try{const n={data:JSON.stringify(e),timestamp:Date.now(),version:a},s=this.getKey("locale",t);this.adapter.setItem(s,JSON.stringify(n))}catch(n){}}getCachedLocaleData(t,e=864e5){try{const n=this.getKey("locale",t),s=this.adapter.getItem(n);if(!s)return null;const i=JSON.parse(s);return i.version!==a||Date.now()-i.timestamp>e?(this.adapter.removeItem(n),null):JSON.parse(i.data)}catch(n){return null}}cacheTranslation(t,e,n,s){try{const i={data:s,timestamp:Date.now(),version:a},r=this.getKey("translation",`${e}_${n}_${t}`);this.adapter.setItem(r,JSON.stringify(i))}catch(i){}}getCachedTranslation(t,e,n,s=6048e5){try{const i=this.getKey("translation",`${e}_${n}_${t}`),r=this.adapter.getItem(i);if(!r)return null;const o=JSON.parse(r);return o.version!==a||Date.now()-o.timestamp>s?(this.adapter.removeItem(i),null):o.data}catch(i){return null}}setCachedTranslation(t,e,n,s){try{const i=this.getKey("translation",`${e}_${n}_${t}`),r={data:s,timestamp:Date.now(),version:a};this.adapter.setItem(i,JSON.stringify(r))}catch(i){}}clearCache(){try{if(this.adapter instanceof c)this.adapter.clear();else{const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);n&&n.startsWith(o)&&t.push(n)}t.forEach(t=>this.adapter.removeItem(t))}}catch(t){}}getCacheStats(){let t=0,e=0;try{if(this.adapter instanceof c)return{totalItems:0,totalSize:0};for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s&&s.startsWith(o)){t++;const n=localStorage.getItem(s);n&&(e+=s.length+n.length)}}}catch(n){}return{totalItems:t,totalSize:e}}}const u=new l;function h(t){if(!t||"string"!=typeof t)return{valid:!1,error:"API key is required"};if(""===t.trim())return{valid:!1,error:"API key cannot be empty"};if(t.length<10)return{valid:!1,error:"API key too short (minimum 10 characters)"};if(t.length>200)return{valid:!1,error:"API key too long (maximum 200 characters)"};if(t.includes(" ")||t.includes("\n")||t.includes("\t"))return{valid:!1,error:"API key contains invalid characters"};if("undefined"!=typeof process&&"production"===process.env.NODE_ENV){const e=["test","demo","mock","example","dev"],n=t.toLowerCase();for(const t of e)if(n.includes(t))break}return{valid:!0}}function d(t){if("string"!=typeof t)throw new Error("Input must be a string");if(t.length>1e4)throw new Error("Input text too long (max 10000 characters)");return t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")}function f(t){if(!t||"string"!=typeof t)return{valid:!1,error:"Locale is required"};return/^[a-z]{2}(-[A-Z]{2})?$/.test(t)?{valid:!0}:{valid:!1,error:"Invalid locale format (expected: en, en-US, etc.)"}}const p=new class{constructor(t=100,n=6e4){e(this,"requests",new Map),e(this,"maxRequests"),e(this,"windowMs"),this.maxRequests=t,this.windowMs=n}isAllowed(t){const e=Date.now(),n=(this.requests.get(t)||[]).filter(t=>e-t<this.windowMs);return!(n.length>=this.maxRequests)&&(n.push(e),this.requests.set(t,n),!0)}getRemaining(t){const e=Date.now(),n=(this.requests.get(t)||[]).filter(t=>e-t<this.windowMs);return Math.max(0,this.maxRequests-n.length)}};class g extends Error{constructor(t,e,n,s,i){super(t),this.status=e,this.code=n,this.isQuotaExceeded=s,this.quotaDetails=i,this.name="RustleAPIError"}}const w=class t{constructor(){e(this,"notificationHistory",new Set),e(this,"isCI"),this.isCI=!!("undefined"!=typeof process&&(process.env.CI||process.env.GITHUB_ACTIONS||process.env.GITLAB_CI||process.env.JENKINS_URL||process.env.TRAVIS||process.env.CIRCLECI||process.env.BUILDKITE||process.env.DRONE))}static getInstance(){return t.instance||(t.instance=new t),t.instance}notifyQuotaExceeded(t){var e;const n=`quota-exceeded-${(null==(e=t.quotaDetails)?void 0:e.limit)||"unknown"}`;if(this.notificationHistory.has(n))return;this.notificationHistory.add(n);const s=this.formatQuotaMessage(t);this.isCI?this.logCIError(s,t):this.logDevelopmentError(s,t)}notifyAPIError(t,e){const n=`api-error-${t.code||t.status}-${e||"general"}`;if(this.notificationHistory.has(n))return;this.notificationHistory.add(n);const s=this.formatAPIErrorMessage(t,e);this.isCI?this.logCIError(s,t):this.logDevelopmentError(s,t)}formatQuotaMessage(t){const e=t.quotaDetails;let n="🚨 RUSTLE.DEV QUOTA EXCEEDED 🚨\n\n";return e&&(n+=`• Quota Limit: ${e.limit||"Unknown"}\n`,n+=`• Used: ${e.used||"Unknown"}\n`,e.resetDate&&(n+=`• Resets: ${e.resetDate}\n`)),n+="\n📋 NEXT STEPS:\n",n+="1. Check your usage at https://rustle.dev/dashboard\n",n+="2. Upgrade your plan at https://rustle.dev/pricing\n",n+="3. Contact support at support@rustle.dev\n",n+="\n📖 Documentation: https://rustle.dev/docs/quota",n}formatAPIErrorMessage(t,e){let n="⚠️ RUSTLE.DEV API ERROR ⚠️\n\n";return e&&(n+=`Context: ${e}\n`),n+=`Error: ${t.message}\n`,t.code&&(n+=`Code: ${t.code}\n`),t.status&&(n+=`Status: ${t.status}\n`),n+="\n📋 TROUBLESHOOTING:\n",n+="1. Check your API key at https://rustle.dev/dashboard\n",n+="2. Verify your network connection\n",n+="3. Check service status at https://rustle.dev/status\n",n+="4. Contact support at support@rustle.dev\n",n+="\n📖 Documentation: https://rustle.dev/docs/troubleshooting",n}logCIError(t,e){process.env.GITHUB_ACTIONS,e.isQuotaExceeded&&"undefined"!=typeof process&&(process.exitCode=1)}logDevelopmentError(t,e){e.isQuotaExceeded,"undefined"!=typeof window&&"Notification"in window&&this.showBrowserNotification(e)}showBrowserNotification(t){"granted"===Notification.permission?new Notification("Rustle.dev API Issue",{body:t.isQuotaExceeded?"Quota exceeded - check your dashboard":"API error occurred",icon:"https://rustle.dev/favicon.ico"}):"denied"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&this.showBrowserNotification(t)})}clearHistory(){this.notificationHistory.clear()}};e(w,"instance");let y=w;function m(){const t="undefined"!=typeof process&&("development"===process.env.NODE_ENV||"undefined"!=typeof window&&"localhost"===window.location.hostname);if("undefined"!=typeof process&&process.env){if(process.env.RUSTLE_API_URL)return process.env.RUSTLE_API_URL;if(process.env.NEXT_PUBLIC_RUSTLE_API_URL)return process.env.NEXT_PUBLIC_RUSTLE_API_URL}if("undefined"!=typeof window){const t=window.__RUSTLE_CONFIG__;if(null==t?void 0:t.apiUrl)return t.apiUrl}return t?"https://api.rustle.dev/api":"https://api.rustle.dev/v1"}class v{constructor(t){e(this,"config"),e(this,"activeRequests",new Map),e(this,"notificationSystem"),this.config={baseUrl:m(),timeout:3e4,...t},this.notificationSystem=y.getInstance();const n=h(this.config.apiKey);if(!n.valid)throw new Error(`Invalid API key: ${n.error}`);const s=function(t){try{const e=new URL(t);if(!["http:","https:"].includes(e.protocol))return{valid:!1,error:"Only HTTP and HTTPS URLs are allowed"};if("undefined"!=typeof process&&"production"===process.env.NODE_ENV){const t=e.hostname;if("localhost"===t||"127.0.0.1"===t||t.startsWith("192.168.")||t.startsWith("10.")||t.startsWith("172."))return{valid:!1,error:"Private IP addresses not allowed in production"}}return{valid:!0}}catch(e){return{valid:!1,error:"Invalid URL format"}}}(this.config.baseUrl);if(!s.valid)throw new Error(`Invalid API URL: ${s.error}`);"undefined"!=typeof window&&"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&window.location.hostname,process.env.NODE_ENV}cancelRequest(t){const e=this.activeRequests.get(t);return!!e&&(e.abort(),this.activeRequests.delete(t),!0)}cancelAllRequests(){for(const[t,e]of this.activeRequests.entries())e.abort();this.activeRequests.clear()}async request(t,e={},n){const s=`${this.config.baseUrl}${t}`,i=n||`${Date.now().toString(36)}-${Math.random().toString(36).substring(2)}`;if(!p.isAllowed(this.config.apiKey))throw new g("Rate limit exceeded. Please try again later.",429,"RATE_LIMIT_EXCEEDED");n&&this.cancelRequest(n);const r=new AbortController,o=setTimeout(()=>r.abort(),this.config.timeout);this.activeRequests.set(i,r);try{const n={},a=await fetch(s,{...e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"X-Request-ID":i,...n,...e.headers},signal:r.signal});if(clearTimeout(o),this.activeRequests.delete(i),!a.ok){const e=await a.json().catch(()=>({})),n=429===a.status||"QUOTA_EXCEEDED"===e.code||"RATE_LIMIT_EXCEEDED"===e.code,s=new g(e.message||`HTTP ${a.status}: ${a.statusText}`,a.status,e.code,n,e.quota);throw n?this.notificationSystem.notifyQuotaExceeded(s):this.notificationSystem.notifyAPIError(s,t),s}return await a.json()}catch(a){if(clearTimeout(o),this.activeRequests.delete(i),a instanceof g)throw a;if(a instanceof Error){if("AbortError"===a.name)throw new g("Request cancelled or timeout");throw new g(`Network error: ${a.message}`)}throw new g("Unknown error occurred")}}async translateBatch(t,e){if(!t.entries||0===t.entries.length)throw new g("No entries provided for translation");if(t.entries.length>100)throw new g("Too many entries (max 100 per batch)");const n=f(t.sourceLanguage);if(!n.valid)throw new g(`Invalid source language: ${n.error}`);const s=f(t.targetLanguage);if(!s.valid)throw new g(`Invalid target language: ${s.error}`);const r={...t,entries:t.entries.map(t=>({...t,text:d(t.text)}))},o=await this.request("/translate/batch",{method:"POST",body:JSON.stringify(r)},e);return o.success&&o.translations&&(o.translations=i.cleanBatchTranslations(o.translations)),o}async translateSingle(t,e,n,s,r){const o=d(t),a=f(e);if(!a.valid)throw new g(`Invalid source language: ${a.error}`);const c=f(n);if(!c.valid)throw new g(`Invalid target language: ${c.error}`);const l={entries:[{id:"single",text:o,context:r&&r.file&&r.tags?{file:r.file,tags:r.tags}:void 0}],sourceLanguage:e,targetLanguage:n,model:s},u=await this.translateBatch(l);if(!u.success)throw new g(u.error||"Translation failed");const h=u.translations.single;if(!h)throw new g("No translation returned");return i.cleanTranslation(h)}async healthCheck(){return this.request("/health")}async getSupportedModels(){return this.request("/models")}}function E(t){return new v(t)}class T{constructor(t,n,s){e(this,"config"),e(this,"currentLocale"),e(this,"localeData"),e(this,"mutationObserver"),e(this,"intersectionObserver"),e(this,"apiClient"),e(this,"fingerprintCounter",0),e(this,"processedElements",new WeakSet),e(this,"pendingTranslations",new Map),e(this,"batchTimeout"),this.config=t,this.currentLocale=n,this.localeData=s,this.apiClient=E({apiKey:t.apiKey})}initialize(){this.config.deactivate||(this.config.debug,this.scanAndProcessDOM(),this.setupMutationObserver(),this.setupIntersectionObserver(),"development"===process.env.NODE_ENV&&setTimeout(()=>{this.scanForMissingContent()},1e3),this.config.debug)}updateLocale(t,e){this.currentLocale=t,this.localeData=e,this.translateAllElements()}scanAndProcessDOM(){const t=this.getTranslatableElements();this.config.debug,t.forEach((t,e)=>{this.processedElements.has(t)||(this.config.debug,this.processElement(t),this.processedElements.add(t))})}scanForMissingContent(){this.config.debug;const t=document.querySelectorAll("*");t.forEach(t=>{if(t.getAttribute("data-i18n-fingerprint"))return;if(!this.isTranslatableElement(t))return;const e=this.getElementTextContent(t);!e.trim()||e.length<2||/[a-zA-Z]/.test(e)&&(t.closest("script, style, noscript")||(this.config.debug,this.processElement(t),this.processedElements.add(t)))}),this.config.debug,this.pendingTranslations.size>0&&this.processPendingTranslations()}getTranslatableElements(){const t=this.buildElementSelector();return Array.from(document.querySelectorAll(t))}buildElementSelector(){const{autoConfig:t}=this.config;let e=["p","h1","h2","h3","h4","h5","h6","span","div","button","a","li"];(null==t?void 0:t.include)&&t.include.length>0&&(e=t.include);const n=((null==t?void 0:t.exclude)||["script","style","code","pre"]).map(t=>`:not(${t})`).join("");return e.map(t=>`${t}${n}:not([data-i18n="false"])`).join(", ")}processElement(t){const e=this.getElementTextContent(t);if(!e.trim())return;if(t.hasAttribute("data-i18n-fingerprint"))return void this.translateElement(t);const n=i.generateContentFingerprint(e);t.setAttribute("data-i18n-fingerprint",n),t.setAttribute("data-i18n","true"),t.setAttribute("data-i18n-original",e),this.translateElement(t),this.config.debug}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return Math.abs(e).toString(16)}getElementTextContent(t){return Array.from(t.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE).map(t=>t.textContent||"").join(" ").trim()}translateElement(t){const e=t.getAttribute("data-i18n-fingerprint");if(!e)return;if(this.config.debug,this.currentLocale===this.config.sourceLanguage){const e=t.getAttribute("data-i18n-original");return void(e&&(this.updateElementText(t,e),this.config.debug))}const n=this.localeData[this.currentLocale];if(n&&n[e]){const s=n[e];this.updateElementText(t,s),this.config.debug}else this.config.debug,this.addToPendingTranslations(t,e)}addToPendingTranslations(t,e){const n=`${this.currentLocale}:${e}`;this.pendingTranslations.has(n)||this.pendingTranslations.set(n,[]);const s=this.pendingTranslations.get(n);s&&!s.includes(t)&&s.push(t),this.batchTimeout&&clearTimeout(this.batchTimeout),this.batchTimeout=setTimeout(()=>{this.processPendingTranslations()},100)}async processPendingTranslations(){if(0===this.pendingTranslations.size)return;const t=this.currentLocale,e=[],n=new Map;for(const[i,r]of this.pendingTranslations.entries()){const[s,o]=i.split(":");if(s===t&&r.length>0&&o){const t=r[0];if(t){const s=t.getAttribute("data-i18n-original");s&&(e.push({id:o,text:s}),n.set(o,r))}}}if(0!==e.length)try{this.config.debug;const s=await this.apiClient.translateBatch({entries:e,sourceLanguage:this.config.sourceLanguage,targetLanguage:t,model:this.config.model});for(const[e,i]of Object.entries(s.translations)){const s=n.get(e);s&&(s.forEach(t=>{this.updateElementText(t,i)}),this.config.debug),this.localeData[t]||(this.localeData[t]={}),this.localeData[t][e]=i}for(const[e]of this.pendingTranslations.entries()){const[n]=e.split(":");n===t&&this.pendingTranslations.delete(e)}}catch(s){if(this.config.fallback)for(const t of n.values())t.forEach(t=>{const e=t.getAttribute("data-i18n-original");e&&this.updateElementText(t,e)});for(const[e]of this.pendingTranslations.entries()){const[n]=e.split(":");n===t&&this.pendingTranslations.delete(e)}}}updateElementText(t,e){t.textContent;this.config.debug,t.textContent=e,this.config.debug}translateAllElements(){document.querySelectorAll("[data-i18n-fingerprint]").forEach(t=>this.translateElement(t))}setupMutationObserver(){this.mutationObserver=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;this.isTranslatableElement(e)&&this.processElement(e);this.getTranslatableElementsInSubtree(e).forEach(t=>this.processElement(t))}})})}),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}setupIntersectionObserver(){this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target;this.processedElements.has(e)||(this.processElement(e),this.processedElements.add(e))}})});this.getTranslatableElements().forEach(t=>{var e;null==(e=this.intersectionObserver)||e.observe(t)})}isTranslatableElement(t){var e;const n=t.tagName.toLowerCase(),{autoConfig:s}=this.config;if(null==(e=null==s?void 0:s.exclude)?void 0:e.includes(n))return!1;if("false"===t.getAttribute("data-i18n"))return!1;return((null==s?void 0:s.include)||["p","h1","h2","h3","h4","h5","h6","span","div","button","a","li"]).includes(n)}getTranslatableElementsInSubtree(t){const e=this.buildElementSelector();return Array.from(t.querySelectorAll(e))}destroy(){var t,e;null==(t=this.mutationObserver)||t.disconnect(),null==(e=this.intersectionObserver)||e.disconnect(),this.batchTimeout&&clearTimeout(this.batchTimeout),this.pendingTranslations.clear()}}class L{constructor(t){e(this,"config"),e(this,"observer",null),e(this,"missingContent",new Map),e(this,"processingQueue",new Set),e(this,"lastProcessTime",0),e(this,"processTimeout",null),this.config=t}start(){this.config.enabled&&"undefined"!=typeof window&&(this.config.debug,this.scanExistingContent(),this.setupMutationObserver(),this.setupPeriodicProcessing())}stop(){this.observer&&(this.observer.disconnect(),this.observer=null),this.processTimeout&&(clearTimeout(this.processTimeout),this.processTimeout=null),this.config.debug}scanExistingContent(){var t;const e=this.findTextNodes(document.body);for(const n of e){const e=null==(t=n.textContent)?void 0:t.trim();if(e&&i.isTranslatableText(e)){const t=n.parentElement;t&&!t.hasAttribute("data-i18n-fingerprint")&&this.addMissingContent(e,t)}}this.config.debug&&this.missingContent.size}setupMutationObserver(){this.observer=new MutationObserver(t=>{for(const e of t)if("childList"===e.type)for(const t of Array.from(e.addedNodes))t.nodeType===Node.ELEMENT_NODE?this.scanElement(t):t.nodeType===Node.TEXT_NODE&&this.checkTextNode(t);else"characterData"===e.type&&this.checkTextNode(e.target)}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}setupPeriodicProcessing(){const t=Math.max(this.config.watchInterval,1e3),e=()=>{this.processTimeout=setTimeout(()=>{this.processMissingContent(),e()},t)};e()}findTextNodes(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:t=>{var e;const n=null==(e=t.textContent)?void 0:e.trim();return n&&n.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let s;for(;s=n.nextNode();)e.push(s);return e}scanElement(t){const e=this.findTextNodes(t);for(const n of e)this.checkTextNode(n)}checkTextNode(t){var e;const n=null==(e=t.textContent)?void 0:e.trim();if(!n||!i.isTranslatableText(n))return;const s=t.parentElement;s&&!s.hasAttribute("data-i18n-fingerprint")&&this.addMissingContent(n,s)}addMissingContent(t,e){const n=i.generateContentFingerprint(t);this.missingContent.has(n)||(this.missingContent.set(n,{text:t,fingerprint:n,element:e,timestamp:Date.now()}),this.config.debug)}async processMissingContent(){if(0===this.missingContent.size)return;const t=Date.now();if(t-this.lastProcessTime<5e3)return;this.lastProcessTime=t,this.config.debug;const e=Array.from(this.missingContent.values());for(const n of e)n.element.isConnected&&(n.element.setAttribute("data-i18n-fingerprint",n.fingerprint),this.config.debug);this.config.autoExtract&&e.length>0&&this.simulateFileUpdates(e),this.missingContent.clear()}simulateFileUpdates(t){if(this.config.debug){t.map(t=>({fingerprint:t.fingerprint,source:t.text,status:"new"}));for(const e of this.config.targetLanguages){t.reduce((t,n)=>(t[n.fingerprint]=`[${e.toUpperCase()}] ${n.text}`,t),{})}}}getStats(){return{missingContentCount:this.missingContent.size,isActive:null!==this.observer,lastProcessTime:this.lastProcessTime}}}let b=null;const A=s.createContext(null);function D(t,e){switch(e.type){case"SET_LOCALE":return{...t,currentLocale:e.payload,error:null};case"SET_LOCALE_DATA":return{...t,localeData:{...t.localeData,[e.payload.locale]:e.payload.data}};case"SET_LOADING":return{...t,isLoading:e.payload};case"SET_ERROR":return{...t,error:e.payload,isLoading:!1};case"CLEAR_ERROR":return{...t,error:null};default:return t}}function I({config:t,children:e,initialLocaleData:i={},cookieString:o}){const a=s.useRef(null),[c,l]=s.useReducer(D,{currentLocale:(()=>{if(t.currentLocale)return t.debug,t.currentLocale;const e=r.getLocaleFromCookie(o);return e&&t.targetLanguages.includes(e)?(t.debug,e):(t.debug,t.sourceLanguage)})(),localeData:i,isLoading:!1,error:null});s.useEffect(()=>{if(t.deactivate)return;(async()=>{const{currentLocale:e}=c;if(!c.localeData[e]&&e!==t.sourceLanguage){l({type:"SET_LOADING",payload:!0});try{const s=`${t.localeBasePath||"/rustle/locales"}/${e}.json`;t.debug;try{const n=await fetch(s);if(n.ok){const s=await n.json();if(s&&Object.keys(s).length>0)return l({type:"SET_LOCALE_DATA",payload:{locale:e,data:s}}),u.cacheLocaleData(e,s),l({type:"SET_LOADING",payload:!1}),void t.debug;t.debug}else t.debug}catch(n){t.debug}const i=u.getCachedLocaleData(e);if(i&&Object.keys(i).length>0)return l({type:"SET_LOCALE_DATA",payload:{locale:e,data:i}}),l({type:"SET_LOADING",payload:!1}),void t.debug;l({type:"SET_LOADING",payload:!1})}catch(s){l({type:"SET_ERROR",payload:s instanceof Error?s.message:"Failed to load translations"})}}})()},[c.currentLocale,t.deactivate,t.sourceLanguage]),s.useEffect(()=>{if(t.deactivate||"undefined"==typeof window)return;(async()=>{t.debug;const e=t.localeBasePath||"/rustle/locales",n=t.targetLanguages.map(async n=>{if(!c.localeData[n]&&n!==t.sourceLanguage)try{const s=await fetch(`${e}/${n}.json`);if(s.ok){const e=await s.json();e&&Object.keys(e).length>0&&(l({type:"SET_LOCALE_DATA",payload:{locale:n,data:e}}),u.cacheLocaleData(n,e),t.debug)}}catch(s){t.debug}});if(await Promise.all(n),t.debug){Object.keys(c.localeData).length}})()},[t.targetLanguages,t.localeBasePath,t.debug,t.deactivate,t.sourceLanguage]),s.useEffect(()=>{if(t.deactivate)return;const e=function(t){const e=[];if("undefined"!=typeof process&&"production"===process.env.NODE_ENV&&t.debug&&e.push("Debug mode is enabled in production - this may expose sensitive information"),"undefined"!=typeof process&&"production"===process.env.NODE_ENV&&t.apiUrl&&t.apiUrl.startsWith("http://")&&e.push("Using insecure HTTP API URL in production - use HTTPS instead"),t.apiKey){const n=h(t.apiKey);n.valid||e.push(`API key validation failed: ${n.error}`)}return e}(t);return e.length>0&&e.forEach(t=>{}),"undefined"!=typeof window&&(a.current=new T(t,c.currentLocale,c.localeData),"development"===process.env.NODE_ENV&&t.auto&&(!function(t){b&&b.stop(),b=new L(t),b.start()}({enabled:!0,debug:t.debug,autoExtract:!0,watchInterval:3e3,apiKey:t.apiKey,sourceLanguage:t.sourceLanguage,targetLanguages:t.targetLanguages,localeBasePath:t.localeBasePath||"/rustle/locales"}),t.debug),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{var t;null==(t=a.current)||t.initialize()}):setTimeout(()=>{var t;null==(t=a.current)||t.initialize()},100)),()=>{var t;null==(t=a.current)||t.destroy(),"development"===process.env.NODE_ENV&&b&&(b.stop(),b=null)}},[t]),s.useEffect(()=>{a.current&&a.current.updateLocale(c.currentLocale,c.localeData)},[c.currentLocale,c.localeData]);const d={config:t,currentLocale:c.currentLocale,setLocale:e=>{if(t.deactivate)return;if(!t.targetLanguages.includes(e)&&e!==t.sourceLanguage)return;const n=c.currentLocale;if(l({type:"SET_LOCALE",payload:e}),r.setLocaleToCookie(e),"undefined"!=typeof window&&e!==n){const s=new CustomEvent("rustleLocaleChanged",{detail:{locale:e,previousLocale:n,timestamp:Date.now()}});window.dispatchEvent(s),t.debug}t.debug},localeData:c.localeData,isLoading:c.isLoading,error:c.error};return n.jsx(A.Provider,{value:d,children:e})}function S(){const t=s.useContext(A);if(!t)throw new Error("useRustleContext must be used within a RustleProvider");return t}function O({children:t}){const{currentLocale:e,localeData:r,config:o}=S(),a=s.useMemo(()=>r[e]?(o.debug,r[e]):(o.debug,{}),[e,r,o.debug]),c=s.useCallback(t=>{if(!t||"string"!=typeof t)return null;if(a[t])return a[t];for(const[n,s]of Object.entries(a))if(s===t||n===t)return s;const e=t.trim().toLowerCase();for(const[,n]of Object.entries(a))if("string"==typeof n&&n.trim().toLowerCase()===e)return n;return null},[a]),l=s.useCallback(t=>s.Children.map(t,t=>{if(s.isValidElement(t)){const e=t.props;if("true"===e["data-i18n-pause"]||!0===e["data-i18n-pause"])return o.debug,t;const n=e["data-i18n-fingerprint"];let r=null;if(n&&a[n])r=a[n],o.debug;else if("string"==typeof e.children&&e.children.trim()&&(r=c(e.children),r&&o.debug,!r&&"development"===process.env.NODE_ENV&&o.auto)){i.generateContentFingerprint(e.children);o.debug}if(r)return s.cloneElement(t,{...e,"data-i18n-original":e.children,"data-i18n":"true"},r);if(e.children){const n=l(e.children);return s.cloneElement(t,e,n)}}return t}),[a,o.debug]);return n.jsx(n.Fragment,{children:l(t)})}const $={enabled:!0,type:"skeleton",duration:0,skeletonProps:{height:"1em",width:"100%",borderRadius:"3px",backgroundColor:"#e2e8f0",animationDuration:"1.2s"}};exports.AutoTranslate=O,exports.RustleAPIError=g,exports.RustleBox=function({children:t,sourceLanguage:e="en",targetLanguages:s=["es","fr","de","it","pt"],apiKey:i,model:o="gpt-3.5-turbo",debug:a=!1,auto:c=!0,fallback:l=!0,initialLocale:u,serverLocale:h,useVirtualDOM:d=!0,localeBasePath:f="/rustle/locales",loadingConfig:p=$}){if(!i||""===i.trim())throw new Error("RustleBox: apiKey is required. Please provide a valid API key to use Rustle.dev services.");const g=(()=>{const t=r.getLocaleFromCookie();if(t&&s.includes(t))return t;return h||u||e})(),w=t=>{s.includes(t)&&(r.setLocaleToCookie(t),"undefined"!=typeof window&&window.location.reload())};"undefined"!=typeof window&&(window.rustleSwitchLocale=w);const y={deactivate:!1,sourceLanguage:e,targetLanguages:s,currentLocale:g,apiKey:i,model:o,debug:a,auto:c,fallback:l,localeBasePath:f,useVirtualDOM:d,loadingConfig:p,switchLocale:w};return n.jsx(I,{config:y,initialLocaleData:{},children:d?n.jsx(O,{children:t}):t})},exports.StorageManager=l,exports.createAPIClient=E,exports.defaultStorageManager=u,exports.useRustle=function(){const t=S(),[e,n]=s.useState(!1),[i,r]=s.useState(null),{config:o,currentLocale:a,setLocale:c,localeData:l}=t,h=s.useCallback(async(t,e)=>{var s;if(o.deactivate)return t;const i=e||a;if(i===o.sourceLanguage)return t;const c=null==(s=l[i])?void 0:s[t];if(c)return c;const h=u.getCachedTranslation(t,o.sourceLanguage,i);if(h)return h;n(!0),r(null);try{const e=E({apiKey:o.apiKey}),s=await e.translateSingle(t,o.sourceLanguage,i,o.model);return u.cacheTranslation(t,o.sourceLanguage,i,s),o.debug,n(!1),s}catch(d){const e=d instanceof Error?d.message:"Translation failed";if(r(e),n(!1),o.debug,o.fallback)return t;throw new Error(e)}},[o,a,l]);return{currentLocale:a,setLocale:c,translate:h,isLoading:e||t.isLoading,error:i||t.error}},exports.useRustleContext=S;
